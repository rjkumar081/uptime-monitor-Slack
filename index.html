<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Uptime Monitor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #14263f 0, #050814 55%, #02040a 100%);
      color: #f9fbff;
      display: flex;
      justify-content: center;
    }

    .page {
      width: 100%;
      max-width: 960px;
      padding: 16px;
    }

    .card {
      background: rgba(6, 23, 42, 0.96);
      border-radius: 20px;
      padding: 18px 16px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.75);
      border: 1px solid rgba(59, 130, 246, 0.28);
    }

    .sparkline-shell {
      margin-top: 10px;
      height: 80px;
      border-radius: 12px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      background: radial-gradient(circle at top, #052e16, #020617);
      position: relative;
      overflow: hidden;
    }

    .sparkline-line {
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      transition: 0.4s ease;
    }

    .sparkline-label {
      position: absolute;
      bottom: 3px;
      left: 10px;
      font-size: 10px;
      color: #6b7280;
    }

    .status-chip {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .status-led {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #22c55e;
      box-shadow: 0 0 10px #22c55e;
    }

    .status-led.down {
      background:#ef4444;
      box-shadow:0 0 10px #ef4444;
    }

  </style>
</head>
<body>
<main class="page">
<section class="card">

<h2>Uptime Monitor</h2>
<p>Live data from status.json</p>

<div class="status-chip">
  <div class="status-led" id="statusLed"></div>
  <strong id="statusText">LOADING</strong>
</div>

<p id="headline">Waiting for data...</p>

<p><strong>URL:</strong> <span id="targetUrl">—</span></p>
<p><strong>HTTP:</strong> <span id="httpCode">—</span></p>
<p><strong>Checked:</strong> <span id="lastChecked">—</span></p>

<hr style="margin:15px 0">

<div><strong>Snapshot</strong></div>
<p>Status: <span id="snapStatus">—</span></p>
<p>Emoji: <span id="snapEmoji">—</span></p>
<p>Message: <span id="snapSlack">—</span></p>

<div class="sparkline-shell">
  <div class="sparkline-line" id="sparkLine"></div>
  <div class="sparkline-label" id="sparkLabel">Waiting...</div>
</div>

<button id="refreshBtn">Refresh</button>

</section>
</main>

<script>
const targetUrlEl = document.getElementById("targetUrl");
const httpCodeEl = document.getElementById("httpCode");
const lastCheckedEl = document.getElementById("lastChecked");

const statusLedEl = document.getElementById("statusLed");
const statusTextEl = document.getElementById("statusText");
const headlineEl = document.getElementById("headline");

const snapStatusEl = document.getElementById("snapStatus");
const snapEmojiEl = document.getElementById("snapEmoji");
const snapSlackEl = document.getElementById("snapSlack");

const sparkLine = document.getElementById("sparkLine");
const sparkLabel = document.getElementById("sparkLabel");
const refreshBtn = document.getElementById("refreshBtn");

let historyStates = [];

function updateSparkline(state){
  historyStates.push(state);
  if(historyStates.length > 30) historyStates.shift();

  const ups = historyStates.filter(s=>s==="up").length;
  const downs = historyStates.filter(s=>s==="down").length;
  sparkLabel.textContent = `Last ${historyStates.length} checks | UP:${ups} DOWN:${downs}`;

  if(state==="down"){
    sparkLine.style.background = "linear-gradient(90deg,#ef4444,#fca5a5)";
    sparkLine.style.boxShadow = "0 0 12px rgba(248,113,113,1)";
    sparkLine.style.top = "55px";
  } else if(state==="up"){
    sparkLine.style.background = "linear-gradient(90deg,#22c55e,#4ade80)";
    sparkLine.style.boxShadow = "0 0 12px rgba(34,197,94,1)";
    sparkLine.style.top = "15px";
  } else {
    sparkLine.style.background = "linear-gradient(90deg,#3b82f6,#93c5fd)";
    sparkLine.style.boxShadow = "0 0 12px rgba(147,197,253,1)";
    sparkLine.style.top = "35px";
  }
}

async function loadStatus(){
  try{
    const res = await fetch("status.json?_="+Date.now());
    const data = await res.json();

    const state = data.status?.toLowerCase() || "unknown";

    targetUrlEl.textContent = data.siteUrl || "—";
    httpCodeEl.textContent = data.httpCode || "—";
    lastCheckedEl.textContent = data.checkedAt || "—";

    statusLedEl.classList.toggle("down", state==="down");
    statusTextEl.textContent = state.toUpperCase();

    headlineEl.textContent = state==="up" ? "All systems operational"
                          : state==="down" ? "Website DOWN detected"
                          : "Unknown status";

    snapStatusEl.textContent = state.toUpperCase();
    snapEmojiEl.textContent = data.emoji || "—";
    snapSlackEl.textContent = data.slackMessage || `${state} | HTTP ${data.httpCode}`;

    updateSparkline(state);

  } catch(e){
    statusTextEl.textContent = "ERROR";
    headlineEl.textContent = "Could not load status.json";
  }
}

refreshBtn.onclick = loadStatus;
loadStatus();
setInterval(loadStatus,2000);
</script>
</body>
</html>
