name: Website Uptime Monitor

on:
  schedule:
    - cron: "*/5 * * * *"   # har 5 minute
  workflow_dispatch:        # manually run karne ke liye

jobs:
  check-website:
    runs-on: ubuntu-latest

    steps:
      - name: Check Website Status and Notify Slack
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          SITE_URL: "https://cinepolis.com/in"
        run: |
          # Time IST me
          TIMESTAMP=$(TZ="Asia/Kolkata" date "+%Y-%m-%d %H:%M:%S")

          # Browser jaisa request (bot block avoid)
          STATUS=$(curl -s -o /dev/null -w "%{http_code}" \
            --user-agent "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" \
            --max-time 15 \
            "$SITE_URL")

          if [ "$STATUS" = "000" ] || [ "$STATUS" -lt 200 ] || [ "$STATUS" -ge 300 ]; then
            EMOJI="ðŸš¨"
            STATE_TEXT="DOWN"
          else
            EMOJI="âœ…"
            STATE_TEXT="UP"
          fi

          MESSAGE="$EMOJI Website $STATE_TEXT
URL: $SITE_URL
Status: HTTP $STATUS
Time: $TIMESTAMP"

          # JSON payload banao
          payload=$(printf '{"text":"%s"}' "$MESSAGE")

          # âœ… Yahan koi backslash nahi, pure single line
          curl -X POST -H "Content-type: application/json" --data "$payload" "$SLACK_WEBHOOK_URL"
