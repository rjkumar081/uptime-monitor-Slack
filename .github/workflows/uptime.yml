name: Website Uptime Monitor

on:
  schedule:
    - cron: "*/5 * * * *"
  workflow_dispatch:

jobs:
  check-website:
    runs-on: ubuntu-latest

    steps:
      - name: Check Website Status and Notify Slack
        env:
          SITE_URL: "https://cinepolis.com/in"
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          echo "Checking: $SITE_URL"

          # Time IST me
          TIMESTAMP=$(TZ="Asia/Kolkata" date "+%Y-%m-%d %H:%M:%S")
          echo "Current time (IST): $TIMESTAMP"

          # Browser jaisa request
          STATUS=$(curl -s -o /dev/null -w "%{http_code}" \
            --user-agent "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" \
            --max-time 15 \
            "$SITE_URL")

          echo "HTTP status: $STATUS"

          if [ "$STATUS" = "000" ] || [ "$STATUS" -lt 200 ] || [ "$STATUS" -ge 300 ]; then
            EMOJI="ðŸš¨"
            STATE_TEXT="DOWN"
          else
            EMOJI="âœ…"
            STATE_TEXT="UP"
          fi

          MESSAGE="$EMOJI Website $STATE_TEXT
URL: $SITE_URL
Status: HTTP $STATUS
Time: $TIMESTAMP"

          echo "Sending to Slack:"
          echo "$MESSAGE"

          payload=$(printf '{"text":"%s"}' "$MESSAGE")

          curl -X POST -H "Content-type:application/json" \
            --data "$payload" \
            "$SLACK_WEBHOOK_URL"
