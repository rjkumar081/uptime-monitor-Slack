name: Website Uptime Monitor

on:
  schedule:
    - cron: "*/5 * * * *"
  workflow_dispatch:

jobs:
  check-website:
    runs-on: ubuntu-latest

    steps:
      - name: Check Website Status and Notify Slack
        run: |
          SITE_URL="https://cinepolis.com/in"
          TIMESTAMP=$(TZ="Asia/Kolkata" date "+%Y-%m-%d %H:%M:%S")

          STATUS=$(curl -s -o /dev/null -w "%{http_code}" \
            --user-agent "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" \
            --max-time 15 \
            "$SITE_URL")

          if [ "$STATUS" = "000" ] || [ "$STATUS" -lt 200 ] || [ "$STATUS" -ge 300 ]; then
            MESSAGE="ðŸš¨ Website DOWN\nURL: $SITE_URL\nStatus: HTTP $STATUS\nTime: $TIMESTAMP"
          else
            MESSAGE="âœ… Website UP\nURL: $SITE_URL\nStatus: HTTP $STATUS\nTime: $TIMESTAMP"
          fi

          curl -X POST -H "Content-type: application/json" \
          --data "{\"text\":\"$MESSAGE\"}" \
          "${{ secrets.SLACK_WEBHOOK_URL }}"
